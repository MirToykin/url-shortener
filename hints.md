## Конспект
### GOROOT
через GOROOT можно настраивать разные версии Go (Preferences->Go->GOROOT)
### idle_timeout
Сервер обычно оптимизирован таким образмом, что если от одного клиента приходит несколько 
запросов с небольшим интервалом, то поскольку нет смысла на каждый запрос от одного клиента
открывать и закрывать соединение оно держится открытым какое-то время. Но если клиент долго 
не шлет запросы, то такое соединение закрывается. idle_timeout и есть время ожидания повторного
запроса до закрытия соединения.

### Must префикс в имени функции
По соглашению Must используется в именах функций которые паникуют, т.е. не возвращают ошибку.
Так стоит делать в редких случаях, когда при ошибке не возможна дальнейшая работа приложения.

### slog
slog - это не конкретный логгер, а скорее некая обертка для логгера. Это библиотека для работы
с логгерами. Он имеет несколько дефолтных логгеров - это текстовый и json. Текстовый для просмотра
информации локально при запуске, а json для отправки на сервер, где они будут обработаны сборщиком/агрегатором
логов. Но в него можно интегрировать и другой логгер, например, logrus.

### chi
- для более удобного отслеживания информации по запросам можно добавить **middleware.RequestID**, которая идет из 
коробки в данном пакете.
- **middleware.Recoverer** - если внутри обработчика запроса возникнет "паника" данный middleware не даст упасть приложению
- **middleware.URLFormat** - для использования параметров внутри url: router.Get("/{alias}", handler)

### Сети
- в нашем случае при редиректе лучше использовать код 302 (found) а не 301 (moved permanently) поскольку при статусе
301 браузер может кэшировать ответ и если мы изменим alias либо вовсе его удалим из-за кэша клиент по прежнему будет
перенаправляться на закэшированный url

**Дополнительные парметры могут быть использованы как для одного лога, так и для всех:**
- log.Info("starting url shortener", slog.String("env", cfg.Env))
- log = log.With(slog.String("env", cfg.Env))

### Структура проекта
- **internal/lib** - каталог для различных вспомогательных функций для разных компонентов проекта
- в целом короткие непонятные имена пакетов считаются плохой практикой, но если в этом пакете разме
щен функционал, который используется очень часто, то этим можно пренебречь. Например, **internal/lib/logger/sl**, пакет sl
будет использоваться при каждом логировании ошибки (sl - slog)

### Особенности языка
- если нам нужен импорт, который нигде явно не используется, то для него можно использовать
заглушку _ , например **_ "github.com/mattn/go-sqlite3"**
- при запуске горутины в цикле не рекомендуется использовать переменную цикла. Лучше сделать ее локальную копию.
Поскольку заранее неизвествно когда планировщик запустит горутины возможна ситуация что до их запуска цикл уже
отработает полностью или частично, в таком случае если не сделать копию переменной цикла, а передать ее по ссылке 
и при этом старт первой поставленной в очередь горутины будет выполнен, например, после окончания цикла, тогда эта
горутина получит значение последней итерации, а не первой, как задумывалось. Поэтому перед запуском рекомендуется 
делать локальную копию переменной цикла.

### Тесты
- **slogdiscard** - для тестов нам не нужно фактическое логирование, поэтому ми пишем еще одну реализацию логгера, 
который логи эмулирует написание логов.
- **mock** - некая сущность, которая имитирует поведение реального объекта. Например, мы не хотим передавать в тесты наш 
полноценный storage, который будет подключаться к БД, что-то сохранять и т.д. Мы просто хотим использовать объект
имитирующий storage. Длы генерации таких моков будет использоваться библиотека **mockery**.
- **t.Parallel()** - используется для параллельного запуска тестов. При использовании табличных тестов нужно не забыть 
сделать локальную копию тесткейса.
- **gofakeit** - позволяет генерировать случайные данные (имена, фамилии, email, номера телефонов и т.д.)
- **httpexpect** - для тестирования http сервисов

## TODO
- закончить TestSaveHandler (учесть CheckIfAliasExists)
- тест обработчика удаления